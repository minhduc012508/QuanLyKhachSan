---Tạo bảng khách hàng---
create table KHACHHANG(
MAKH nvarchar(20) primary key,	
HOTEN	nvarchar(40),
DCHI	nvarchar(50),
SODT	nvarchar(20),
NGSINH	smalldatetime,
NGDK	smalldatetime,
DOANHSO	money
)

---Tạo bảng sản phẩm---
CREATE TABLE SANPHAM
(
MaSP NVARCHAR(20) primary key,
TenSP NVARCHAR(100),
DonVi NVARCHAR(10) DEFAULT '',
NUOCSX	NVARCHAR(40),
GIA	money,

)

---Tạo bảng nhà cung cấp---
CREATE TABLE NHACC
(
MaNhaCC NVARCHAR (20) primary key,
TenNhaCC NVARCHAR(100),
DiaChi NVARCHAR (200),
DienThoai NVARCHAR(20) DEFAULT 'Chua co'

)

---Tạo bảng đơn đặt hàng---
CREATE TABLE DONDH
(
SoDH NVARCHAR(20) primary key,
MaNhaCC NVARCHAR(20) FOREIGN KEY (MaNhaCC) REFERENCES NhaCC(MaNhaCC),
NgayDH DATETIME DEFAULT GETDATE(),

)

---Tạo bảng chi tiết đơn đặt hàng---
CREATE TABLE CTDONDH
(
SoDH NVARCHAR(20) FOREIGN KEY (SoDH) REFERENCES DONDH(SoDH),
MaSP NVARCHAR(20) FOREIGN KEY (MaSP) REFERENCES SANPHAM(MaSP),
SLDat INT CHECK(SLDat > 0),
PRIMARY KEY(SoDH,MaSP),

)

---Tạo bảng phiếu nhập hàng---
CREATE TABLE PNHAP
(
SoPN NVARCHAR(20) PRIMARY KEy,
SoDH NVARCHAR(20) FOREIGN KEY (SoDH) REFERENCES DONDH(SoDH),
NgayNhap DATETIME

)

---Tạo bảng chi tiết phiếu nhập---
CREATE TABLE CTPNHAP
(
SoPN NVARCHAR(20) FOREIGN KEY (SoPN) REFERENCES PNHAP(SoPN),
MaSP NVARCHAR(20) FOREIGN KEY (MaSP) REFERENCES SANPHAM(MaSP),
SLNhap INT,
DGNhap MONEY
PRIMARY KEY(SoPN,MaSP),
CONSTRAINT CHK_CTPNHAP_SLNhap CHECK(SLNhap > 0 AND DGNhap > 0)
)

---Tạo bảng hóa đơn ---
CREATE TABLE HOADON
(
SOHD NVARCHAR(20) primary key ,
NGHD smalldatetime,
MAKH NVARCHAR(20) FOREIGN KEY(MAKH) REFERENCES KHACHHANG(MAKH),
TONGHOADON	money

)

---Tạo bảng chi tiết hóa đơn---
CREATE TABLE CTHD
(
SOHD NVARCHAR(20) FOREIGN KEY(SOHD) REFERENCES HOADON(SOHD),
MaSP NVARCHAR(20) FOREIGN KEY(MaSP) REFERENCES SANPHAM(MaSP),
SL INT,
DGXuat MONEY
PRIMARY KEY(SOHD,MaSP),
CONSTRAINT CHK_CTPXUAT_SLXuat_DGXuat CHECK(SL > 0 AND DGXuat > 0)
)

---Tạo bảng tồn kho---
CREATE TABLE TONKHO
(
NamThang CHAR(6),
MaSP NVARCHAR(20) FOREIGN KEY(MaSP) REFERENCES SANPHAM(MaSP),
SLDau INT DEFAULT 0,
TongSLN INT DEFAULT 0,
TongSLX INT DEFAULT 0,
SLCuoi AS SLDau + TongSLN - TongSLX,
PRIMARY KEY(NamThang,MaSP),
CONSTRAINT CHK_TONKHO_SLDau_TongSLN_TongSLX 
CHECK(SLDau >= 0 AND TongSLN >= 0 AND TongSLX >= 0)
)

INSERT INTO TONKHO(NamThang,MaSP,SLDau,TongSLN,TongSLX) VALUES('200201','BC01',0,10,6)
INSERT INTO TONKHO(NamThang,MaSP,SLDau,TongSLN,TongSLX) VALUES('200201','BC02',0,15,7)
INSERT INTO TONKHO(NamThang,MaSP,SLDau,TongSLN,TongSLX) VALUES('200201','BC03',0,30,10)
INSERT INTO TONKHO(NamThang,MaSP,SLDau,TongSLN,TongSLX) VALUES('200202','BB01',4,0,0)
INSERT INTO TONKHO(NamThang,MaSP,SLDau,TongSLN,TongSLX) VALUES('200202','BB02',8,0,0)
INSERT INTO TONKHO(NamThang,MaSP,SLDau,TongSLN,TongSLX) VALUES('200202','ST07',20,0,0)
INSERT INTO TONKHO(NamThang,MaSP,SLDau,TongSLN,TongSLX) VALUES('200202','TV01',5,0,0)
INSERT INTO TONKHO(NamThang,MaSP,SLDau,TongSLN,TongSLX) VALUES('200202','TV02',12,0,0)